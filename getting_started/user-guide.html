

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Guide &mdash; Container Guts &#39;Guts&#39; 0.0.16 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-argparse.css?v=24ffd50e" />
      <link rel="stylesheet" type="text/css" href="../_static/theme.css?v=1e8d79bf" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=c7cdf6fe"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="container_guts package" href="../api_reference/container_guts.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Container Guts 'Guts'
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#commands">Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#manifest">Manifest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#similar">Similar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#diff">Diff</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#github-action">GitHub Action</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/container_guts.html">container_guts package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/modules.html">container_guts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Container Guts 'Guts'</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Getting Started</a></li>
      <li class="breadcrumb-item active">User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/getting_started/user-guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-guide">
<span id="getting-started-user-guide"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Link to this heading"></a></h1>
<p>If you haven’t installed Guts yet, you should read <a class="reference internal" href="installation.html#getting-started-installation"><span class="std std-ref">Installation</span></a> first.</p>
<section id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Link to this heading"></a></h2>
<p>Guts currently has just one client command, “manifest” to
get a manifest of executables on the <code class="docutils literal notranslate"><span class="pre">PATH</span></code>!</p>
<section id="manifest">
<h3>Manifest<a class="headerlink" href="#manifest" title="Link to this heading"></a></h3>
<p>Using guts on the command line is the easiest way to test it manually,
and by default, the results will be printed to the screen. The manifest
command will generate “guts” for an image:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>guts<span class="w"> </span>manifest<span class="w"> </span>ubuntu
</pre></div>
</div>
<p>If you provide an output file, it will save to it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>guts<span class="w"> </span>manifest<span class="w"> </span>--outfile<span class="w"> </span>ubuntu-guts.json<span class="w"> </span>ubuntu
</pre></div>
</div>
<p>By default, we extract executables on the PATH. However, you can also ask
to extract all filesystem paths:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>guts<span class="w"> </span>manifest<span class="w"> </span>--include<span class="w"> </span>fs<span class="w"> </span>ubuntu
</pre></div>
</div>
<p>Or to get fs and paths:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>guts<span class="w"> </span>manifest<span class="w"> </span>--include<span class="w"> </span>paths<span class="w"> </span>--include<span class="w"> </span>fs<span class="w"> </span>ubuntu<span class="w"> </span>--outfile<span class="w"> </span>ubuntu-guts.json
</pre></div>
</div>
<p>This generic “manifest” command is the main entrypoint to extract guts.</p>
</section>
<section id="similar">
<h3>Similar<a class="headerlink" href="#similar" title="Link to this heading"></a></h3>
<p>This command calculates a similarity comparison between your container and the database
of base images we maintain with shpc. We do this based on filesystem paths. We first remove
all paths that are unique to your image, and then with what is left, we calculate the intersection
over the total filesystem paths left in your image, which is saying “The percentage of non-unique
paths that are shared between your image and the contender base.”</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>guts<span class="w"> </span>similar<span class="w"> </span>vanessa/salad
</pre></div>
</div>
</section>
<section id="diff">
<h3>Diff<a class="headerlink" href="#diff" title="Link to this heading"></a></h3>
<p>A diff will take your container and compares it against a set of base images,
and only reveals the diff output (the executables in PATH that are special
to your container). If you don’t provide a database (repository or path
on the filesystem) we use the default at <code class="docutils literal notranslate"><span class="pre">singularityhub/shpc-guts</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>guts<span class="w"> </span>diff<span class="w"> </span>vanessa/salad
</pre></div>
</div>
<section id="github-action">
<h4>GitHub Action<a class="headerlink" href="#github-action" title="Link to this heading"></a></h4>
<p>You can use one of our GitHub actions to extract guts!</p>
<section id="single-image-manifest">
<h5>Single Image Manifest<a class="headerlink" href="#single-image-manifest" title="Link to this heading"></a></h5>
<p>For a single image (e.g., on dispatch)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Container Guts</span>
<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">docker_uri</span><span class="p">:</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Docker</span><span class="nv"> </span><span class="s">identifier</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">generate</span><span class="nv"> </span><span class="s">recipe</span><span class="nv"> </span><span class="s">for&#39;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quay.io/autamus/clingo:5.5.1&quot;</span>
<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">generate-recipe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ inputs.docker_uri }}</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Guts for ${{ inputs.docker_uri }}</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">singularityhub/guts/action/manifest@main</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ inputs.docker_uri }}</span>
<span class="w">          </span><span class="nt">outfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ inputs.docker_uri }}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">View Output</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat ${{ matrix.image }}.json</span>
</pre></div>
</div>
</section>
<section id="matrix-images-manifest">
<h5>Matrix Images Manifest<a class="headerlink" href="#matrix-images-manifest" title="Link to this heading"></a></h5>
<p>or for a matrix! E.g., you might want to save them nested in their directory
location.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Container Guts</span>
<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">  </span><span class="nt">generate-recipes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">max-parallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ubuntu&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;centos&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rockylinux:9.0&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;alpine&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;busybox&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Matrix</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Guts for ${{ matrix.image }}</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">singularityhub/guts/action/manifest@main</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.image }}</span>
<span class="w">          </span><span class="nt">outfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.image }}.json</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">View Output</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat ${{ matrix.image }}.json</span>
</pre></div>
</div>
<p>If you want the library to generate the namespace of the output files, you can
instead just provide an output directory. The example below also
shows how to get the path as an output:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>…</p>
<blockquote>
<div><p>name: Generate Matrix
steps:</p>
<blockquote>
<div><ul>
<li><p>name: Checkout Repository
uses: <a class="reference external" href="mailto:actions/checkout&#37;&#52;&#48;v3">actions/checkout<span>&#64;</span>v3</a></p></li>
<li><p>name: Guts for ${{ matrix.image }}
uses: <a class="reference external" href="mailto:singularityhub/guts/action/manifest&#37;&#52;&#48;main">singularityhub/guts/action/manifest<span>&#64;</span>main</a>
id: guts
with:</p>
<blockquote>
<div><p>image: ${{ matrix.image }}
outdir: ${{ github.workspace }}</p>
</div></blockquote>
</li>
<li><p>name: View Output
env:</p>
<blockquote>
<div><p>outfile: ${{ steps.guts.outputs.outfile }}</p>
</div></blockquote>
<p>run: cat ${outfile}</p>
</li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="id1">
<h5>Diff<a class="headerlink" href="#id1" title="Link to this heading"></a></h5>
<p>The core functionality of guts is to discover new or interesting things in
the PATH, and this is the goal of diff. You can provide a guts root
path with your custom guts (e.g., the content of <a class="reference external" href="https://github.com/singularityhub/shpc-guts">shpc-guts</a>
but if it’s not provided, we will clone that one, which updates
base images nightly.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Diff Container Guts</span>
<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">  </span><span class="nt">generate-recipes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">max-parallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;vanessa/salad&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Diffs</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Diff for ${{ matrix.image }}</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">singularityhub/guts/action/diff@main</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guts</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.image }}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">View Output</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat ${{ steps.guts.outputs.outfile }}</span>
</pre></div>
</div>
<p>The above would be the same as doing:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Diff for ${{ matrix.image }}</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">singularityhub/guts/action/diff@main</span>
<span class="w">  </span><span class="nt">with</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.image }}</span>
<span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/singularityhub/shpc-guts</span>
</pre></div>
</div>
<p>Note that for all of the above, by default guts will be installed for you, unless you install a custom
version in a previous step.</p>
</section>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api_reference/container_guts.html" class="btn btn-neutral float-right" title="container_guts package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Vanessa Sochat.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>